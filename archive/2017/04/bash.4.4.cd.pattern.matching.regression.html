<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bash 4.4 'cd' Pattern Matching Regression</title>
    <meta name="robots" content="index, follow">
    <meta name="description" content="Blog for Grayson Kent - Linux,Security,Networking,Virtualization">
    <meta name="author" content="Grayson Kent"/>
    <script type="text/javascript" src="../../js/SyntaxHighlight/shCore.js"></script>
    <script type="text/javascript" src="../../js/SyntaxHighlight/Plain.js"></script>
    <script type="text/javascript" src="../../js/SyntaxHighlight/Cpp.js"></script>
    <script type="text/javascript" src="../../js/SyntaxHighlight/Bash.js"></script>
    <link href="../../css/shThemeDefault.css" rel="stylesheet" type="text/css"/>
    <link href="../../css/shCore.css" rel="stylesheet" type="text/css"/>
    <link href="../../css/posts.css" rel="stylesheet" type="text/css"/>
    <link rel="icon" type="image/png" href="../../../images/tux.png">
</head>
<ul id="header">
    <li class="navbar"><a href="mailto:grayson@linux.com" class="button">Contact</a></li>
    <li class="navbar"><a href="../../../about.html" class="button">About</a></li>
    <li class="navbar"><a href="../../index.html" class="button">Archive</a></li>
    <li class="navbar"><a href="../../../index.html" class="button">Home</a></li>
</ul>
<h2>Bash 4.4 'cd' Pattern Matching Regression <span class="date">4/17/2017</span></h2>
<p><a href="https://askubuntu.com/q/905832/668095">This question</a> popped up on StackOverflow last night and I thought
    it was interesting that <span class="highlight">cd</span> initially looks like it doesn't behave like <span
            class="highlight">ls</span> in regards to pattern matching, even though they are both builtins.</p>
<p>The person was using <span class="highlight">cd album*</span> to move into the first directory out of a set of <span
        class="highlight">album-0{1..2}</span> directories.</p>
<p>This stopped working with an upgrade to Ubuntu 17.04 (and subsequently Bash-4.4-RC1) and instead threw this
    error:</p>
<pre class="brush: bash">
					bash: cd: too many arguments
</pre>
<p>I would never personally rely on this matching behavior, but it <i>is</i> interesting that it is saying <span
        class="highlight">cd</span> is having an issue with multiple arguments as the <a
        href="https://www.gnu.org/software/bash/manual/bash.html#index-cd">Bash manual's cd section</a> even says that:
</p>
<pre class="brush: plain">
				Any additional arguments following directory are ignored.
</pre>
<h3>What changed?</h3>
<p>Looking through the <a href="https://ftp.gnu.org/gnu/bash/">Bash Source Code</a>, I noticed <a
        href="http://git.savannah.gnu.org/cgit/bash.git/commit/config-top.h?id=a0c0a00fc419b7bc08202a79134fcd5bc0427071">one
    interesting commit</a> that added the following to <a
        href="http://git.savannah.gnu.org/cgit/bash.git/tree/config-top.h#n30">config-top.h</a>:</p>
<pre class="brush: cpp">
/* Define CD_COMPLAINS if you want the non-standard, but sometimes-desired
   error messages about multiple directory arguments to `cd'. */

#define CD_COMPLAINS
</pre>
<p>And the specific error message from the question is mentioned in <a
        href="http://git.savannah.gnu.org/cgit/bash.git/tree/builtins/cd.def#n326">builtins/cd.def</a>:</p>
<pre class="brush: cpp">
#if defined (CD_COMPLAINS)
  else if (list->next)
    {
      builtin_error (_("too many arguments"));
      return (EXECUTION_FAILURE);
    }
#endif
</pre>
<h3>Proving it</h3>
<p>Bash 4.4 Beta where it still works:</p>
<pre class="brush: bash">
    #Pulling and unpacking source
    $ wget https://ftp.gnu.org/gnu/bash/bash-4.4-beta.tar.gz
    $ tar -xzvf bash-4.4-beta.tar.gz
    $ cd bash-4.4-beta

    #Building, go grab something to drink. It's gonna be a while.
    ~/bash-4.4-beta$ ./configure
    ~/bash-4.4-beta$ make

    #Check Version
    ~/bash-4.4-beta$ ./bash --version
    GNU bash, version 4.4.0(1)-beta (x86_64-unknown-linux-gnu)

    #Enter a clean interactive prompt
    ~/bash-4.4-beta$ env -i PATH="$PWD:$PATH" ./bash --noprofile --norc

    #Test example
    bash-4.4$ mkdir album-0{1..2}
    bash-4.4$ cd album* && pwd
    /home/gkent/bash-4.4-beta/album0-1
</pre>

<p>Bash 4.4 Stable Release where it doesn't work:</p>
<pre class="brush: bash">
    #Pulling and unpacking source
    $ wget https://ftp.gnu.org/gnu/bash/bash-4.4.tar.gz
    $ tar -zxvf bash-4.4.tar.gz
    $ cd bash-4.4/

    #Building, go grab something to drink. It's gonna be a while.
    ~/bash-4.4$ ./configure
    ~/bash-4.4$ make

    #Check Version
    ~/bash-4.4$ ./bash -version
    GNU bash, version 4.4.0(1)-release (x86_64-unknown-linux-gnu)

    #Enter a clean interactive prompt
    ~/bash-4.4$ env -i PATH="$PWD:$PATH" ./bash --noprofile --norc

    #Test example
    bash-4.4$ mkdir album-0{1..2}
    bash-4.4$ cd album*
    bash: cd: too many arguments
</pre>
<h3>So what now?</h3>
<p>It seems that the implementation of <span class="highlight">cd</span> and the documentation of it got off somewhere
    along the way. <a href="https://bugs.launchpad.net/ubuntu/+source/bash/+bug/1683576">A bug report</a> was filed from
    that thread, so we will see the response on that. If you truly depend on this pattern matching functionality, then
    you could build your own Bash and remove the <b>CD_COMPLAINS</b> or override the command like <a
            href="https://askubuntu.com/a/905851/668095">Byte Commander</a> suggested:</a></p>
<pre class="brush: bash">
    cd(){ builtin cd "${@:1:1}"; }
</pre>
<p>But that comes with its own issue of remembering to unset that if you need to test the real <span class="highlight">cd</span>.
</p>
<p>Finally, you could go out of your way and make a working function alias out of something like this:</p>
<pre class="brush: bash">
    cd "$(find $1* | head -1)"
</pre>
<div class="footer"></div>
<script type="text/javascript">SyntaxHighlighter.all()</script>
</html>